(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c97dc95e"],{"129f":function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e===1/t:e!=e&&t!=t}},"14c3":function(e,t,a){var r=a("c6b6"),n=a("9263");e.exports=function(e,t){var a=e.exec;if("function"===typeof a){var i=a.call(e,t);if("object"!==typeof i)throw TypeError("RegExp exec method returned something other than an Object or null");return i}if("RegExp"!==r(e))throw TypeError("RegExp#exec called on incompatible receiver");return n.call(e,t)}},"159b":function(e,t,a){var r=a("da84"),n=a("fdbc"),i=a("17c2"),o=a("9112");for(var s in n){var c=r[s],l=c&&c.prototype;if(l&&l.forEach!==i)try{o(l,"forEach",i)}catch(u){l.forEach=i}}},"17c2":function(e,t,a){"use strict";var r=a("b727").forEach,n=a("a640"),i=a("ae40"),o=n("forEach"),s=i("forEach");e.exports=o&&s?[].forEach:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}},"2bb6":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"settingDanger-wrap"}},[a("div",{staticClass:"tree-wrap"},[a("div",{staticClass:"button"}),a("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入搜索类别",size:"small",clearable:""},model:{value:e.state,callback:function(t){e.state=t},expression:"state"}},[a("template",{slot:"append"},[a("i",{staticClass:"el-icon-search"})])],2),a("el-tree",{ref:"attrList",attrs:{data:e.store.store.state.SettingDangerStore.tree,props:e.defaultProps,"highlight-current":""},on:{"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.node;t.data;return a("span",{staticClass:"span-ellipsis"},[a("span",{attrs:{title:r.label}},[e._v(e._s(r.label))])])}}])})],1),a("div",{staticClass:"data-wrap"},[a("div",{staticClass:"statistics"}),a("div",{staticClass:"table-search"},[a("div",[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.dialogType="addDanger",e.openDialog("添加危险源")}}},[e._v("添加危险源")]),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.dialogType="del",e.openDialog("删除")}}},[e._v("删除")]),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.dialogType="QR",e.openDialog("查看二维码")}}},[e._v("查看二维码")])],1),a("div",[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.searchTable}},[e._v("搜索")])],1)]),a("div",{staticClass:"table-wrap"},[a("el-table",{ref:"table",staticStyle:{width:"100%"},attrs:{data:e.tableData,"tooltip-effect":"dark","header-row-class-name":e.headerRow,"header-cell-class-name":e.headerRow,"cell-class-name":e.cell,border:"","row-key":e.getRowKey},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55","reserve-selection":!0}}),a("el-table-column",{attrs:{prop:"place",label:"施工部位","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"sourceOfRisk",label:"危险因素","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"accident",label:"引发事故","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"measures",label:"防范措施","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticClass:"btn",on:{click:function(a){return e.getEdit(t.row.id)}}},[e._v("修改")]),a("span",{staticClass:"btn",on:{click:function(a){return e.delAlone(t.row.id)}}},[e._v("删除")])]}}])})],1)],1),a("div",{staticClass:"page-wrap"},[a("el-pagination",{attrs:{"current-page":e.pageIndex,"page-size":e.pageSize,layout:"total, prev, pager, next, jumper",total:e.total},on:{"current-change":e.handleCurrentChange}})],1)]),a("div",{staticClass:"add"},[a("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialog,width:"800px","before-close":e.clear},on:{"update:visible":function(t){e.dialog=t}}},["addDanger"===e.dialogType||"edit"===e.dialogType?a("ul",e._l(e.addDanger,(function(t){return a("li",{key:t.name},[a("span",[e._v(e._s(t.name)+"：")]),t.must?a("span",{staticClass:"must"},[e._v("*")]):a("span",{staticClass:"no-must"}),t.list?e._e():a("el-input",{attrs:{type:t.textArea?"textarea":"input",rows:4,placeholder:"请输入",resize:"none"},model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"item.value"}})],1)})),0):e._e(),"del"===e.dialogType?a("div",{staticClass:"del"},[a("p",[e._v("确定删除选中的危险源吗？")])]):e._e(),"QR"===e.dialogType?a("img",{attrs:{src:e.imgSrc}}):e._e(),"QR"!==e.dialogType?a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.clear}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){"addDanger"===e.dialogType||"edit"===e.dialogType?e.verify():e.getDelList()}}},[e._v("确 定")])],1):e._e()])],1)])},n=[],i=(a("99af"),a("a623"),a("4de4"),a("4160"),a("d81d"),a("b0c0"),a("ac1f"),a("841c"),a("9911"),a("159b"),a("96cf"),a("1da1")),o=a("d4ec"),s=a("bee2"),c=a("262e"),l=a("2caf"),u=a("9ab4"),d=a("60a3"),p=a("9006"),f=(a("d3b7"),a("0613")),h=a("7fc3"),g=a("350b"),v=function(e){Object(c["a"])(a,e);var t=Object(l["a"])(a);function a(e){var r;return Object(o["a"])(this,a),r=t.call(this,e),r.url={},r.treeUrl=h["a"].settingOrganization.tree,r.searchTreeUrl=h["a"].settingOrganization.treeSearch,r.tree=[],r.url=h["a"].danger,r}return Object(s["a"])(a,[{key:"getTree",value:function(e){return g["a"].post(this.treeUrl,e)}},{key:"searchTree",value:function(e){var t=this;g["a"].post(this.searchTreeUrl,e).then((function(e){0===e.code&&t.treeData(e.data)}))}},{key:"treeData",value:function(e){this.tree=e||[]}},{key:"add",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",g["a"].post(this.url.add,t));case 1:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getTable",value:function(e){return g["a"].post(this.url.table,e)}},{key:"del",value:function(e){return g["a"].post(this.url.del,e)}},{key:"getEdit",value:function(e){return g["a"].post(this.url.query,e)}},{key:"edit",value:function(e){return g["a"].post(this.url.edit,e)}},{key:"getQR",value:function(e){var t=this;return new Promise((function(a){a("".concat(t.url.qr,"?projectId=").concat(e))}))}},{key:"refresh",value:function(){this.treeData(null)}}]),a}(p["d"]);Object(u["a"])([p["a"]],v.prototype,"getTree",null),Object(u["a"])([p["a"]],v.prototype,"searchTree",null),Object(u["a"])([p["c"]],v.prototype,"treeData",null),Object(u["a"])([p["a"]],v.prototype,"add",null),Object(u["a"])([p["a"]],v.prototype,"getTable",null),Object(u["a"])([p["a"]],v.prototype,"del",null),Object(u["a"])([p["a"]],v.prototype,"getEdit",null),Object(u["a"])([p["a"]],v.prototype,"edit",null),Object(u["a"])([p["a"]],v.prototype,"getQR",null),Object(u["a"])([p["a"]],v.prototype,"refresh",null),v=Object(u["a"])([Object(p["b"])({namespaced:!0,stateFactory:!0,dynamic:!0,name:"SettingDangerStore",store:f["a"]})],v);var b=v,y=a("7e57"),m=function(e){Object(c["a"])(a,e);var t=Object(l["a"])(a);function a(){var e;return Object(o["a"])(this,a),e=t.call(this),e.state=null,e.defaultProps={children:"children",label:"name"},e.selectList=[],e.dialogTitle=null,e.dialog=!1,e.dialogType=null,e.addDanger=[{name:"施工部位",value:null,must:!0,link:"place"},{name:"引发事故",value:null,must:!0,link:"accident"},{name:"危险因素",value:null,must:!0,textArea:!0,link:"sourceOfRisk"},{name:"防范措施",value:null,must:!0,textArea:!0,link:"measures"}],e.editId=null,e.checkedType=null,e.pageIndex=1,e.total=0,e.pageSize=15,e.tableData=[],e.projectId=sessionStorage.getItem("seeProjectId"),e.tree=[],e.projectName=null,e.imgSrc=null,e.store=Object(p["e"])(b),e}return Object(s["a"])(a,[{key:"mounted",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=document.getElementsByClassName("el-input-group__append")[0],t.addEventListener("click",this.search),this.getTree();case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getTree",value:function(){var e=this;this.store.getTree({projectId:sessionStorage.getItem("seeProjectId")}).then((function(t){0===t.code&&(e.store.store.state.SettingDangerStore.tree||(e.checkedType=t.data[0].deptTypeNo),e.store.treeData(t.data),e.searchTable())}))}},{key:"handleNodeClick",value:function(e){this.projectId=e.uuid,this.checkedType=e.deptTypeNo,"project"===e.deptTypeNo&&(this.projectName=e.name),e.id!==this.projectId&&this.handleCurrentChange(1)}},{key:"search",value:function(){if(this.state)return this.$refs.attrList.store.defaultExpandAll=!0,void this.store.searchTree({name:this.state,projectId:sessionStorage.getItem("seeProjectId")});this.$refs.attrList.store.defaultExpandAll=!1,this.getTree()}},{key:"handleSelectionChange",value:function(e){this.selectList=e,console.log(e)}},{key:"headerRow",value:function(){return"table-header-bg"}},{key:"cell",value:function(){return"table-cell"}},{key:"handleCurrentChange",value:function(e){this.pageIndex=e,this.searchTable()}},{key:"openDialog",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("del"!==this.dialogType||this.selectList.length){e.next=3;break}return y["a"].warning("请选择需要删除的危险源"),e.abrupt("return");case 3:if("addDanger"!==this.dialogType||"project"===this.checkedType){e.next=6;break}return y["a"].warning("公司不可添加危险源"),e.abrupt("return");case 6:if(this.dialogTitle=this.getDialogTotal(t),this.dialog=!0,"QR"!==this.dialogType){e.next=12;break}return e.next=11,this.store.getQR(this.projectId);case 11:this.imgSrc=e.sent;case 12:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getDialogTotal",value:function(e){var t;switch(this.dialogType){case"addDanger":case"edit":t="".concat(this.projectName,"---").concat(e);break;default:t=e;break}return t}},{key:"clear",value:function(){switch(this.dialog=!1,this.dialogType){case"edit":case"addDanger":this.clearObj(this.addDanger);break;default:break}}},{key:"clearObj",value:function(e){e.forEach((function(e){return e.value=null})),this.editId=null}},{key:"verify",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=[],a="",e.t0=this.dialogType,e.next="addDanger"===e.t0?5:"edit"===e.t0?8:11;break;case 5:return t=this.addDanger,a="add",e.abrupt("break",12);case 8:return t=this.addDanger,a="edit",e.abrupt("break",12);case 11:return e.abrupt("break",12);case 12:return e.next=14,this.verifyList(t);case 14:if(e.sent){e.next=17;break}return y["a"].warning("*号项为必填项!"),e.abrupt("return");case 17:a&&this[a](t);case 18:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"add",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var a,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:a={projectId:this.projectId},t.forEach((function(e){a[e.link]=e.value})),this.store.add(a).then((function(e){if(0===e.code)return y["a"].success("成功!"),r.clear(),void r.searchTable();y["a"].warning("失败!")})).catch((function(e){return console.error(e)}));case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"verifyList",value:function(e){return e.filter((function(e){return e.must})).every((function(e){return e.value}))}},{key:"delAlone",value:function(e){this.del([e])}},{key:"getDelList",value:function(){var e=this.selectList.map((function(e){return e.id}));this.del(e)}},{key:"del",value:function(e){var t=this;this.store.del({ids:e}).then((function(e){0===e.code&&(y["a"].success("删除成功!"),t.searchTable(),t.clear())}))}},{key:"searchTable",value:function(){var e=this,t={projectId:this.projectId,pageNum:this.pageIndex,pageSize:this.pageSize};this.store.getTable(t).then((function(t){0===t.code&&(e.tableData=t.data.list,e.total=t.data.total)})).catch((function(e){console.log(e)}))}},{key:"getEdit",value:function(e){var t=this;this.editId=e,this.store.getEdit({id:e}).then((function(e){0===e.code&&(t.dialogType="edit",t.projectName=e.data.projectName,t.openDialog("修改危险源"),t.addDanger.forEach((function(t){t.value=e.data[t.link]})))}))}},{key:"edit",value:function(){var e=this,t={id:this.editId};this.addDanger.forEach((function(e){t[e.link]=e.value})),this.store.edit(t).then((function(t){0===t.code&&"SUCCESS"===t.msg&&(y["a"].success("修改成功"),e.clear(),e.searchTable())}))}},{key:"getRowKey",value:function(e){return e.id}},{key:"beforeDestroy",value:function(){this.store.refresh()}}]),a}(d["b"]);m=Object(u["a"])([Object(d["a"])({})],m);var k=m,x=k,w=(a("d805"),a("2877")),T=Object(w["a"])(x,r,n,!1,null,null,null);t["default"]=T.exports},4160:function(e,t,a){"use strict";var r=a("23e7"),n=a("17c2");r({target:"Array",proto:!0,forced:[].forEach!=n},{forEach:n})},"4de4":function(e,t,a){"use strict";var r=a("23e7"),n=a("b727").filter,i=a("1dde"),o=a("ae40"),s=i("filter"),c=o("filter");r({target:"Array",proto:!0,forced:!s||!c},{filter:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}})},"70cb":function(e,t,a){},"7e57":function(e,t,a){"use strict";var r=a("5c96");function n(e,t){Object(r["Message"])({message:t,type:e,showClose:!0,center:!0,customClass:"message-box"})}t["a"]={success:function(e){n("success",e)},warning:function(e){console.log(e),e?e.response&&e.response.data&&e.response.data.message?n("warning",e.response.data.message):e.message||n("warning",e.message||e):n("warning","未知错误！")},error:function(e){console.log(e),e?e.response&&e.response.data&&e.response.data.message?n("error",e.response.data.message):e.message||n("error",e.message||e):n("error","未知错误！")}}},"841c":function(e,t,a){"use strict";var r=a("d784"),n=a("825a"),i=a("1d80"),o=a("129f"),s=a("14c3");r("search",1,(function(e,t,a){return[function(t){var a=i(this),r=void 0==t?void 0:t[e];return void 0!==r?r.call(t,a):new RegExp(t)[e](String(a))},function(e){var r=a(t,e,this);if(r.done)return r.value;var i=n(e),c=String(this),l=i.lastIndex;o(l,0)||(i.lastIndex=0);var u=s(i,c);return o(i.lastIndex,l)||(i.lastIndex=l),null===u?-1:u.index}]}))},"857a":function(e,t,a){var r=a("1d80"),n=/"/g;e.exports=function(e,t,a,i){var o=String(r(e)),s="<"+t;return""!==a&&(s+=" "+a+'="'+String(i).replace(n,"&quot;")+'"'),s+">"+o+"</"+t+">"}},9263:function(e,t,a){"use strict";var r=a("ad6d"),n=a("9f7f"),i=RegExp.prototype.exec,o=String.prototype.replace,s=i,c=function(){var e=/a/,t=/b*/g;return i.call(e,"a"),i.call(t,"a"),0!==e.lastIndex||0!==t.lastIndex}(),l=n.UNSUPPORTED_Y||n.BROKEN_CARET,u=void 0!==/()??/.exec("")[1],d=c||u||l;d&&(s=function(e){var t,a,n,s,d=this,p=l&&d.sticky,f=r.call(d),h=d.source,g=0,v=e;return p&&(f=f.replace("y",""),-1===f.indexOf("g")&&(f+="g"),v=String(e).slice(d.lastIndex),d.lastIndex>0&&(!d.multiline||d.multiline&&"\n"!==e[d.lastIndex-1])&&(h="(?: "+h+")",v=" "+v,g++),a=new RegExp("^(?:"+h+")",f)),u&&(a=new RegExp("^"+h+"$(?!\\s)",f)),c&&(t=d.lastIndex),n=i.call(p?a:d,v),p?n?(n.input=n.input.slice(g),n[0]=n[0].slice(g),n.index=d.lastIndex,d.lastIndex+=n[0].length):d.lastIndex=0:c&&n&&(d.lastIndex=d.global?n.index+n[0].length:t),u&&n&&n.length>1&&o.call(n[0],a,(function(){for(s=1;s<arguments.length-2;s++)void 0===arguments[s]&&(n[s]=void 0)})),n}),e.exports=s},9911:function(e,t,a){"use strict";var r=a("23e7"),n=a("857a"),i=a("af03");r({target:"String",proto:!0,forced:i("link")},{link:function(e){return n(this,"a","href",e)}})},"9f7f":function(e,t,a){"use strict";var r=a("d039");function n(e,t){return RegExp(e,t)}t.UNSUPPORTED_Y=r((function(){var e=n("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),t.BROKEN_CARET=r((function(){var e=n("^r","gy");return e.lastIndex=2,null!=e.exec("str")}))},a623:function(e,t,a){"use strict";var r=a("23e7"),n=a("b727").every,i=a("a640"),o=a("ae40"),s=i("every"),c=o("every");r({target:"Array",proto:!0,forced:!s||!c},{every:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}})},a640:function(e,t,a){"use strict";var r=a("d039");e.exports=function(e,t){var a=[][e];return!!a&&r((function(){a.call(null,t||function(){throw 1},1)}))}},ac1f:function(e,t,a){"use strict";var r=a("23e7"),n=a("9263");r({target:"RegExp",proto:!0,forced:/./.exec!==n},{exec:n})},ae40:function(e,t,a){var r=a("83ab"),n=a("d039"),i=a("5135"),o=Object.defineProperty,s={},c=function(e){throw e};e.exports=function(e,t){if(i(s,e))return s[e];t||(t={});var a=[][e],l=!!i(t,"ACCESSORS")&&t.ACCESSORS,u=i(t,0)?t[0]:c,d=i(t,1)?t[1]:void 0;return s[e]=!!a&&!n((function(){if(l&&!r)return!0;var e={length:-1};l?o(e,1,{enumerable:!0,get:c}):e[1]=1,a.call(e,u,d)}))}},af03:function(e,t,a){var r=a("d039");e.exports=function(e){return r((function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3}))}},b0c0:function(e,t,a){var r=a("83ab"),n=a("9bf2").f,i=Function.prototype,o=i.toString,s=/^\s*function ([^ (]*)/,c="name";r&&!(c in i)&&n(i,c,{configurable:!0,get:function(){try{return o.call(this).match(s)[1]}catch(e){return""}}})},d784:function(e,t,a){"use strict";a("ac1f");var r=a("6eeb"),n=a("d039"),i=a("b622"),o=a("9263"),s=a("9112"),c=i("species"),l=!n((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})),u=function(){return"$0"==="a".replace(/./,"$0")}(),d=i("replace"),p=function(){return!!/./[d]&&""===/./[d]("a","$0")}(),f=!n((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var a="ab".split(e);return 2!==a.length||"a"!==a[0]||"b"!==a[1]}));e.exports=function(e,t,a,d){var h=i(e),g=!n((function(){var t={};return t[h]=function(){return 7},7!=""[e](t)})),v=g&&!n((function(){var t=!1,a=/a/;return"split"===e&&(a={},a.constructor={},a.constructor[c]=function(){return a},a.flags="",a[h]=/./[h]),a.exec=function(){return t=!0,null},a[h](""),!t}));if(!g||!v||"replace"===e&&(!l||!u||p)||"split"===e&&!f){var b=/./[h],y=a(h,""[e],(function(e,t,a,r,n){return t.exec===o?g&&!n?{done:!0,value:b.call(t,a,r)}:{done:!0,value:e.call(a,t,r)}:{done:!1}}),{REPLACE_KEEPS_$0:u,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:p}),m=y[0],k=y[1];r(String.prototype,e,m),r(RegExp.prototype,h,2==t?function(e,t){return k.call(e,this,t)}:function(e){return k.call(e,this)})}d&&s(RegExp.prototype[h],"sham",!0)}},d805:function(e,t,a){"use strict";var r=a("70cb"),n=a.n(r);n.a},d81d:function(e,t,a){"use strict";var r=a("23e7"),n=a("b727").map,i=a("1dde"),o=a("ae40"),s=i("map"),c=o("map");r({target:"Array",proto:!0,forced:!s||!c},{map:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}})}}]);
//# sourceMappingURL=chunk-c97dc95e.30f3f76a.js.map